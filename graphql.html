<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>GraphQL - Map of zones Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "GraphQL";
    var mkdocs_page_input_path = "graphql.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> Map of zones Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="index.html">Getting started</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="front.html">Front</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="graphql.html">GraphQL</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#api">API</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#queries">Queries</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#subscriptions">Subscriptions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#migrations">Migrations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reating-migrations">Сreating migrations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#initial-migrations">Initial migrations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cli-migrations">CLI migrations</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#console">Console</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#explorer">Explorer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#data-schema">Data schema</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#raw-sql">Raw SQL</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="data/schema.html">GraphQL public schema Types</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="data/schema2.html">GraphQL admin schema Types</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="database.html">Database</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="adaptor.html">Stats adaptor</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="processor.html">Tx processor</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="broker.html">Message broker</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="watcher.html">Watcher</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="height-checker.html">Height checker</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="endpoint-checker.html">Endpoint checker</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="database-cleaner.html">Database cleaner</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="ci%26cd%26cd.html">CI/CD/CD</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Map of zones Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
      
    
    <li>GraphQL</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="graphql">GraphQL</h1>
<p>The Hasura GraphQL Engine provides GraphQL APIs over new or existing <a href="database.html">Postgres databases</a>.</p>
<h2 id="api">API</h2>
<p>By default, the Hasura GraphQL API tracks all tables, but only <a href="database.html#flat-tables">flat tables</a> are publicly accessible (no password required). Interacting with APIs during development is handy using the <a href="graphql.html#explorer">Hasura GraphQL explorer</a>. By default, explorer is located here: <a href="localhost:8081/console/api-explorer">localhost:8081/console/api-explorer</a>.</p>
<p>All tables of the database tracked by the GraphQL engine can be queried over the GraphQL endpoint. If you have a tracked table in your database, its query field is added as a nested field under the query_root root level type.</p>
<p>By default, only <a href="database.html#flat-tables">flat tables</a> are tracked.</p>
<p>You can explore the entire schema and the available queries using the GraphiQL interface in the <a href="graphql.html#console">Hasura console</a> or using <a href="data/schema.html">GraphQL public Schema Types</a> for guest or <a href="data/schema2.html">GraphQL admin Schema Types</a> for admin.</p>
<h3 id="queries">Queries</h3>
<p>GraphQL queries are used to fetch data from the server.</p>
<p>Query request example:</p>
<pre><code>query MyQuery {
  headers(where: {timeframe: {_eq: 24}}) {
    channels_cnt_all
    channels_cnt_period
    timeframe
    top_zone_pair
    zones_cnt_all
    zones_cnt_period
    chart
  }
}
</code></pre>
<p>Query request example with curl:</p>
<pre><code>curl -i -H 'Content-Type: application/json' -X POST -d '{ &quot;query&quot;: &quot;query MyQuery { headers(where: {timeframe: {_eq: 24}}) { channels_cnt_all channels_cnt_period timeframe top_zone_pair zones_cnt_all zones_cnt_period chart } }&quot; }' http://localhost:8081/v1/graphql
</code></pre>
<p>Query response example with curl:</p>
<pre><code>HTTP/1.1 200 OK
Transfer-Encoding: chunked
Date: Sun, 29 Nov 2020 19:27:25 GMT
Server: Warp/3.2.27
x-request-id: 03f7f31b-4290-4821-ac61-b569d3316e69
Content-Type: application/json; charset=utf-8

{&quot;data&quot;:{&quot;headers&quot;:[{&quot;channels_cnt_all&quot;:292,&quot;channels_cnt_period&quot;:0,&quot;timeframe&quot;:24,&quot;top_zone_pair&quot;:[],&quot;zones_cnt_all&quot;:185,&quot;zones_cnt_period&quot;:0,&quot;chart&quot;:[{&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}, {&quot;txs&quot;: 0}]}]}}
</code></pre>
<h3 id="subscriptions">Subscriptions</h3>
<p>A GraphQL subscription is essentially a query where the client receives an update whenever the value of any field changes upstream. Subscriptions are supported for all kinds of queries. All the concepts of queries hold true for subscriptions as well.</p>
<p>The Hasura GraphQL engine subscriptions are actually live queries, i.e. a subscription will return the latest result of the query being made and not necessarily all the individual events leading up to the result.</p>
<p>By default updates are delivered to clients every 1 sec. This interval can be configured via the <code>HASURA_GRAPHQL_LIVE_QUERIES_MULTIPLEXED_REFETCH_INTERVAL</code> env var.</p>
<p>Subscription request example:</p>
<pre><code>subscription MySubscription {
  headers(where: {timeframe: {_eq: 24}}) {
    channels_cnt_all
    channels_cnt_period
    timeframe
    top_zone_pair
    zones_cnt_all
    zones_cnt_period
    chart
  }
}
</code></pre>
<p>Hasura GraphQL engine uses the <a href="https://github.com/apollographql/subscriptions-transport-ws/blob/master/PROTOCOL.md">GraphQL over WebSocket Protocol</a> by the <a href="https://github.com/apollographql/subscriptions-transport-ws">apollographql/subscriptions-transport-ws</a> library for sending and receiving events.</p>
<p>You can read more about the implementation of subscriptions in the <a href="https://github.com/hasura/graphql-engine/blob/master/architecture/live-queries.md">architecture doc</a>.</p>
<h2 id="migrations">Migrations</h2>
<p>The Hasura GraphQL migration engine is used to manage database migrations. Use the <a href="https://hasura.io/docs/1.0/graphql/manual/hasura-cli/install-hasura-cli.html#install-hasura-cli">Hasura CLI</a> to manage migration or use pre-built initial migrations when running Hasura (development only).</p>
<h3 id="reating-migrations">Сreating migrations</h3>
<p>When working with the database through the <code>hasura console</code>, the changes will be exported to the migration and metadata directory where the <code>hasura cli</code> was initialized.</p>
<p>See the <a href="graphql.html#cli-migrations">CLI migtations</a> for further adjustments and management of migrations.</p>
<h3 id="initial-migrations">Initial migrations</h3>
<p>Initial migrations of the <a href="database.html">database</a> and Hasura GraphQL metadata occur if the configuration has parameter values:</p>
<ul>
<li>HASURA_GRAPHQL_MIGRATIONS_DIR</li>
<li>HASURA_GRAPHQL_METADATA_DIR</li>
</ul>
<p>If the values are set correctly, then all migrations located in the configured directories will be performed. Each database migration must be located in a separate directory <code>&lt;migration_number&gt;_&lt;migration_name&gt;</code>. Each such directory should contain up.sql for new changes and down.sql to revert to a previous state.</p>
<h3 id="cli-migrations">CLI migrations</h3>
<p>All commands must be executed in the hasura directory or initialized a new directory, by default <code>./hasura</code> directory.</p>
<ul>
<li>
<p><code>hasura init</code> - Initialize directory for Hasura GraphQL Engine migrations, but you can use the existing <code>hasura</code> directory. You will need to specify the configuration in the <code>config.yaml</code> file.</p>
</li>
<li>
<p><code>hasura migrate create baseline --from-server</code> - Exports a snapshot of the current database schema named <code>baseline</code> to the <code>migrations</code> directory.</p>
</li>
<li>
<p><code>hasura metadata export</code> - Exports the entire hasura metadata schema. The uploaded data is placed in the <code>metadata</code> directory.</p>
</li>
<li>
<p><code>hasura console --console-port 8083</code> - Runs hasura console on <a href="localhost:8083/console">localhost:8083/console</a>.</p>
</li>
<li>
<p><code>hasura migrate create &lt;name-of-migration&gt;</code> - Create sql and yaml files required for a migration.</p>
</li>
<li>
<p><code>hasura migrate squash --name "&lt;feature-name&gt;" --from &lt;migration-version&gt;</code> - Squash multiple migrations leading upto the latest one into a single migration file.</p>
</li>
<li>
<p><code>hasura migrate apply --endpoint &lt;server-endpoint&gt;</code> - Apply migrations on the database.</p>
</li>
<li>
<p><code>hasura metadata apply --endpoint &lt;server-endpoint&gt;</code> - Apply Hasura metadata on a database.</p>
</li>
<li>
<p><code>hasura migrate status</code> - Display current status of migrations on a database.</p>
</li>
</ul>
<h2 id="console">Console</h2>
<p>It is very convenient to use Hasura console during development. Some of its parts are presented below.</p>
<p>During production, it is not recommended to automatically enable the console along with hasura, but it is recommended to connect to hasura remotely by running the console locally. See examples in <a href="graphql.html#cli-migrations">CLI migrations</a>.</p>
<h3 id="explorer">Explorer</h3>
<p><img alt="Explorer" src="img/hasura-explorer.PNG" /></p>
<h3 id="data-schema">Data schema</h3>
<p><img alt="data_schema" src="img/hasura-data-schema.PNG" /></p>
<h3 id="raw-sql">Raw SQL</h3>
<p><img alt="raw_sql" src="img/hasura-raw-sql.PNG" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data/schema.html" class="btn btn-neutral float-right" title="GraphQL public schema Types">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="front.html" class="btn btn-neutral" title="Front"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="front.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="data/schema.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
